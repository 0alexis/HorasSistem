<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Formato Militar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            color: #007cba;
            margin-top: 0;
        }
        
        .time-input {
            width: 120px;
            padding: 8px;
            border: 2px solid #007cba;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            text-align: center;
            margin: 10px;
        }
        
        .time-input:focus {
            outline: none;
            border-color: #005a87;
            box-shadow: 0 0 0 2px rgba(0, 124, 186, 0.2);
        }
        
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #005a87;
        }
        
        .segmento-item {
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .segmento-numero {
            background: #007cba;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .segmento-campos {
            display: flex;
            gap: 10px;
            flex: 1;
            align-items: center;
        }
        
        .segmento-campos select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 120px;
        }
        
        .btn-eliminar {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .btn-eliminar:hover {
            background: #c82333;
        }
        
        .btn-agregar {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }
        
        .btn-agregar:hover {
            background: #218838;
        }
        
        .controles {
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 4px;
        }
        
        .info-panel {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info-panel h4 {
            margin-top: 0;
            color: #0066cc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Prueba de Formato Militar (00:00 - 23:59)</h1>
        
        <div class="info-panel">
            <h4>‚ÑπÔ∏è Informaci√≥n del Test</h4>
            <p>Esta p√°gina prueba la implementaci√≥n del formato militar en inputs de tiempo. 
            Los valores deben mostrarse en formato 24 horas (00:00 a 23:59) sin indicadores AM/PM.</p>
        </div>
        
        <div class="test-section">
            <h3>üìù Test 1: Inputs B√°sicos de Tiempo</h3>
            <p>Prueba inputs individuales con formato militar:</p>
            
            <label>Hora de Inicio: <input type="time" class="time-input" id="test1" step="900" min="00:00" max="23:59"></label><br>
            <label>Hora de Fin: <input type="time" class="time-input" id="test2" step="900" min="00:00" max="23:59"></label><br>
            
            <button onclick="probarFormato()">Probar Formato</button>
            <button onclick="limpiarTest()">Limpiar</button>
            
            <div id="resultado1" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìã Test 2: Simulaci√≥n de Segmentos de Turno</h3>
            <p>Prueba la funcionalidad completa de segmentos:</p>
            
            <div class="controles">
                <button class="btn-agregar" onclick="agregarSegmento()">‚ûï Agregar Segmento</button>
                <button onclick="aplicarPlantilla('N')">üìã Plantilla Normal</button>
                <button onclick="aplicarPlantilla('F')">üìã Plantilla Festivo</button>
                <button onclick="aplicarPlantilla('E')">üìã Plantilla Especial</button>
                <button onclick="validarSegmentos()">‚úÖ Validar Segmentos</button>
            </div>
            
            <div id="segmentos-lista"></div>
            <div id="resultado2" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üîß Test 3: Conversi√≥n de Formatos</h3>
            <p>Prueba la conversi√≥n autom√°tica de formatos:</p>
            
            <input type="text" id="input12h" placeholder="Ingresa hora en formato 12h (ej: 2:30 PM)" style="width: 200px; padding: 8px;">
            <button onclick="convertirA24h()">Convertir a Militar</button>
            <div id="resultado3" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Estado del Sistema</h3>
            <div id="estado-sistema" class="result info">
                <strong>Estado:</strong> <span id="estado-texto">Inicializando...</span>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de tipos de segmento
        const SEGMENTO_TIPOS = [
            ['NORMAL', 'Normal'],
            ['FESTIVO', 'Festivo'],
            ['NOCTURNO', 'Nocturno'],
            ['DOMINGO', 'Domingo'],
            ['EXTRA', 'Extra'],
            ['COMPENSATORIO', 'Compensatorio']
        ];
        
        // Plantillas predefinidas
        const PLANTILLAS = {
            'N': {
                nombre: 'Turno Normal',
                segmentos: [{inicio: '08:00', fin: '16:00', tipo: 'NORMAL'}]
            },
            'F': {
                nombre: 'Turno Festivo',
                segmentos: [
                    {inicio: '08:00', fin: '12:00', tipo: 'NORMAL'},
                    {inicio: '12:00', fin: '18:00', tipo: 'FESTIVO'}
                ]
            },
            'E': {
                nombre: 'Turno Especial',
                segmentos: [
                    {inicio: '22:00', fin: '06:00', tipo: 'NOCTURNO'},
                    {inicio: '06:00', fin: '14:00', tipo: 'NORMAL'},
                    {inicio: '14:00', fin: '22:00', tipo: 'FESTIVO'}
                ]
            }
        };
        
        let segmentos = [];
        let segmentoId = 0;
        
        // Funci√≥n para forzar formato militar
        function forzarFormatoMilitar() {
            console.log('üîß Aplicando formato militar...');
            
            // Configurar todos los inputs de tiempo
            document.querySelectorAll('input[type="time"]').forEach(input => {
                // Configuraci√≥n militar
                input.setAttribute('step', '900'); // 15 minutos
                input.setAttribute('data-format', 'military');
                input.setAttribute('min', '00:00');
                input.setAttribute('max', '23:59');
                
                // Agregar eventos para mantener formato militar
                input.addEventListener('change', function() {
                    validarFormatoMilitar(this);
                });
                
                input.addEventListener('input', function() {
                    validarFormatoMilitar(this);
                });
                
                input.addEventListener('click', function() {
                    this.setAttribute('data-format', 'military');
                    this.setAttribute('step', '900');
                    this.setAttribute('min', '00:00');
                    this.setAttribute('max', '23:59');
                });
                
                input.addEventListener('focus', function() {
                    this.setAttribute('data-format', 'military');
                    this.setAttribute('step', '900');
                    this.setAttribute('min', '00:00');
                    this.setAttribute('max', '23:59');
                });
            });
            
            // Agregar estilos CSS para forzar formato militar
            if (!document.getElementById('military-styles')) {
                const style = document.createElement('style');
                style.id = 'military-styles';
                style.textContent = `
                    input[type="time"] {
                        -webkit-appearance: none !important;
                        -moz-appearance: none !important;
                        appearance: none !important;
                        text-align: center !important;
                        font-family: 'Courier New', monospace !important;
                        font-size: 14px !important;
                    }
                    
                    input[type="time"]::-webkit-datetime-edit-ampm-field,
                    input[type="time"]::-moz-datetime-edit-ampm-field,
                    input[type="time"]::-ms-datetime-edit-ampm-field {
                        display: none !important;
                        width: 0 !important;
                        height: 0 !important;
                        overflow: hidden !important;
                        opacity: 0 !important;
                        pointer-events: none !important;
                        position: absolute !important;
                        left: -9999px !important;
                    }
                    
                    input[type="time"]::-webkit-datetime-edit-hour-field,
                    input[type="time"]::-webkit-datetime-edit-minute-field {
                        -webkit-appearance: none !important;
                        text-align: center !important;
                        font-family: 'Courier New', monospace !important;
                    }
                    
                    input[type="time"]::-moz-datetime-edit-hour-field,
                    input[type="time"]::-moz-datetime-edit-minute-field {
                        text-align: center !important;
                        font-family: 'Courier New', monospace !important;
                    }
                    
                    input[type="time"]::-webkit-datetime-edit {
                        text-align: center !important;
                        font-family: 'Courier New', monospace !important;
                    }
                    
                    input[type="time"]::-moz-datetime-edit {
                        text-align: center !important;
                        font-family: 'Courier New', monospace !important;
                    }
                `;
                document.head.appendChild(style);
            }
            
            console.log('‚úÖ Formato militar aplicado');
        }
        
        // Funci√≥n para validar formato militar
        function validarFormatoMilitar(input) {
            const valor = input.value;
            if (!valor) return;
            
            // Convertir de formato 12 horas a militar si es necesario
            if (valor.includes('AM') || valor.includes('PM')) {
                const valorMilitar = convertirA24Horas(valor);
                input.value = valorMilitar;
                console.log(`üîÑ Convertido: ${valor} ‚Üí ${valorMilitar}`);
            }
            
            // Validar formato HH:MM
            const regexMilitar = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
            if (regexMilitar.test(valor)) {
                const [horas, minutos] = valor.split(':').map(Number);
                if (horas >= 0 && horas <= 23 && minutos >= 0 && minutos <= 59) {
                    const valorFormateado = `${horas.toString().padStart(2, '0')}:${minutos.toString().padStart(2, '0')}`;
                    if (valor !== valorFormateado) {
                        input.value = valorFormateado;
                        console.log(`üîß Formateado: ${valor} ‚Üí ${valorFormateado}`);
                    }
                }
            }
        }
        
        // Funci√≥n para convertir de 12h a 24h
        function convertirA24Horas(tiempo12h) {
            try {
                const [tiempo, periodo] = tiempo12h.split(' ');
                const [horas, minutos] = tiempo.split(':').map(Number);
                
                let horas24 = horas;
                if (periodo === 'PM' && horas !== 12) {
                    horas24 = horas + 12;
                } else if (periodo === 'AM' && horas === 12) {
                    horas24 = 0;
                }
                
                return `${horas24.toString().padStart(2, '0')}:${minutos.toString().padStart(2, '0')}`;
            } catch (e) {
                console.error('Error al convertir formato:', e);
                return tiempo12h;
            }
        }
        
        // Funci√≥n para probar formato
        function probarFormato() {
            const test1 = document.getElementById('test1');
            const test2 = document.getElementById('test2');
            const resultado = document.getElementById('resultado1');
            
            const valor1 = test1.value;
            const valor2 = test2.value;
            
            let mensaje = '<strong>Resultado de la prueba:</strong><br>';
            mensaje += `Test 1: ${valor1 || 'vac√≠o'}<br>`;
            mensaje += `Test 2: ${valor2 || 'vac√≠o'}<br><br>`;
            
            if (valor1 && valor2) {
                const regexMilitar = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
                const esValido1 = regexMilitar.test(valor1);
                const esValido2 = regexMilitar.test(valor2);
                
                if (esValido1 && esValido2) {
                    mensaje += '‚úÖ Ambos valores est√°n en formato militar correcto';
                    resultado.className = 'result success';
                } else {
                    mensaje += '‚ùå Alguno de los valores no est√° en formato militar';
                    resultado.className = 'result error';
                }
            } else {
                mensaje += '‚ö†Ô∏è Por favor, ingresa valores en ambos campos';
                resultado.className = 'result info';
            }
            
            resultado.innerHTML = mensaje;
        }
        
        // Funci√≥n para limpiar test
        function limpiarTest() {
            document.getElementById('test1').value = '';
            document.getElementById('test2').value = '';
            document.getElementById('resultado1').innerHTML = '';
        }
        
        // Funci√≥n para agregar segmento
        function agregarSegmento() {
            const nuevoSegmento = {
                id: segmentoId++,
                inicio: '',
                fin: '',
                tipo: 'NORMAL'
            };
            
            segmentos.push(nuevoSegmento);
            renderizarSegmentos();
        }
        
        // Funci√≥n para renderizar segmentos
        function renderizarSegmentos() {
            const container = document.getElementById('segmentos-lista');
            container.innerHTML = '';
            
            segmentos.forEach((segmento, index) => {
                const tiposOptions = SEGMENTO_TIPOS.map(([valor, etiqueta]) => 
                    `<option value="${valor}" ${segmento.tipo === valor ? 'selected' : ''}>${etiqueta}</option>`
                ).join('');
                
                const html = `
                    <div class="segmento-item" data-id="${segmento.id}">
                        <div class="segmento-numero">${index + 1}</div>
                        <div class="segmento-campos">
                            <input type="time" value="${segmento.inicio}" placeholder="Inicio" 
                                   class="time-input" step="900" min="00:00" max="23:59"
                                   onchange="actualizarSegmento(${segmento.id}, 'inicio', this.value)">
                            <input type="time" value="${segmento.fin}" placeholder="Fin" 
                                   class="time-input" step="900" min="00:00" max="23:59"
                                   onchange="actualizarSegmento(${segmento.id}, 'fin', this.value)">
                            <select onchange="actualizarSegmento(${segmento.id}, 'tipo', this.value)">
                                ${tiposOptions}
                            </select>
                        </div>
                        <button class="btn-eliminar" onclick="eliminarSegmento(${segmento.id})">üóëÔ∏è</button>
                    </div>
                `;
                
                container.innerHTML += html;
            });
            
            // Aplicar formato militar a los nuevos inputs
            forzarFormatoMilitar();
        }
        
        // Funci√≥n para actualizar segmento
        function actualizarSegmento(id, campo, valor) {
            const segmento = segmentos.find(s => s.id === id);
            if (segmento) {
                segmento[campo] = valor;
                console.log(`üìù Segmento ${id} actualizado:`, segmento);
            }
        }
        
        // Funci√≥n para eliminar segmento
        function eliminarSegmento(id) {
            segmentos = segmentos.filter(s => s.id !== id);
            renderizarSegmentos();
        }
        
        // Funci√≥n para aplicar plantilla
        function aplicarPlantilla(plantillaKey) {
            const plantilla = PLANTILLAS[plantillaKey];
            if (plantilla) {
                segmentos = plantilla.segmentos.map((seg, index) => ({
                    id: segmentoId++,
                    inicio: seg.inicio,
                    fin: seg.fin,
                    tipo: seg.tipo
                }));
                
                renderizarSegmentos();
                
                const resultado = document.getElementById('resultado2');
                resultado.innerHTML = `<div class="result success">‚úÖ Plantilla "${plantilla.nombre}" aplicada</div>`;
            }
        }
        
        // Funci√≥n para validar segmentos
        function validarSegmentos() {
            const errores = [];
            
            if (segmentos.length === 0) {
                errores.push('Debe tener al menos 1 segmento');
            }
            
            segmentos.forEach((segmento, index) => {
                if (!segmento.inicio || !segmento.fin) {
                    errores.push(`Segmento ${index + 1}: Faltan horas de inicio o fin`);
                }
                
                if (segmento.inicio && segmento.fin) {
                    const regexMilitar = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
                    if (!regexMilitar.test(segmento.inicio)) {
                        errores.push(`Segmento ${index + 1}: Hora de inicio no est√° en formato militar`);
                    }
                    if (!regexMilitar.test(segmento.fin)) {
                        errores.push(`Segmento ${index + 1}: Hora de fin no est√° en formato militar`);
                    }
                }
            });
            
            const resultado = document.getElementById('resultado2');
            if (errores.length === 0) {
                resultado.innerHTML = `<div class="result success">‚úÖ Todos los segmentos son v√°lidos</div>`;
            } else {
                resultado.innerHTML = `
                    <div class="result error">
                        <strong>‚ùå Errores de validaci√≥n:</strong>
                        <ul>${errores.map(error => `<li>${error}</li>`).join('')}</ul>
                    </div>
                `;
            }
        }
        
        // Funci√≥n para convertir input de 12h a 24h
        function convertirA24h() {
            const input12h = document.getElementById('input12h').value;
            const resultado = document.getElementById('resultado3');
            
            if (input12h) {
                const valorMilitar = convertirA24Horas(input12h);
                resultado.innerHTML = `
                    <div class="result success">
                        <strong>Conversi√≥n:</strong><br>
                        Entrada: ${input12h}<br>
                        Salida: ${valorMilitar}
                    </div>
                `;
            } else {
                resultado.innerHTML = `
                    <div class="result info">
                        Por favor, ingresa una hora en formato 12 horas (ej: 2:30 PM)
                    </div>
                `;
            }
        }
        
        // Funci√≥n para actualizar estado del sistema
        function actualizarEstado() {
            const estadoTexto = document.getElementById('estado-texto');
            const inputs = document.querySelectorAll('input[type="time"]');
            const formatoMilitar = Array.from(inputs).every(input => 
                input.getAttribute('data-format') === 'military'
            );
            
            let estado = '';
            if (formatoMilitar) {
                estado = '‚úÖ Formato militar aplicado correctamente';
            } else {
                estado = '‚ùå Formato militar no aplicado completamente';
            }
            
            estadoTexto.textContent = estado;
        }
        
        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando prueba de formato militar...');
            
            // Aplicar formato militar
            forzarFormatoMilitar();
            
            // Actualizar estado inicial
            actualizarEstado();
            
            // Actualizar estado cada 2 segundos
            setInterval(actualizarEstado, 2000);
            
            console.log('‚úÖ Prueba inicializada correctamente');
        });
    </script>
</body>
</html> 
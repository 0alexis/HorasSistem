{% load i18n static %}

<nav class="sidebar" id="sidebar">
    <!-- Toggle Button -->
    <div class="sidebar-toggle" onclick="toggleSidebar()">
        <span class="toggle-icon">☰</span>
    </div>
    
    <div class="sidebar-header">
        <h3>
            <span class="sidebar-icon">🏠</span>
            <span class="sidebar-text">HORASSISTEM</span>
        </h3>
    </div>
    
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="/welcome/" class="nav-link {% if request.resolver_match.url_name == 'welcome' %}active{% endif %}" data-tooltip="Inicio">
                <span class="nav-icon">🏠</span>
                <span class="nav-text">Inicio</span>
            </a>
        </li>
        
        <!-- Gestión de Empresas, Proyectos - Desplegable -->
        <li class="nav-item has-submenu">
            <a href="#" class="nav-link" onclick="toggleSubmenu(this)" data-tooltip="Empresas">
                <span class="nav-icon">🏢</span>
                <span class="nav-text">Empresas</span>
            </a>
            <ul class="submenu">
                <li>
                    <a href="{% url 'empresas:empresas_list' %}" class="submenu-link">
                        <span class="submenu-icon">📋</span>
                        Lista de Empresas
                    </a>
                </li>
                <li>
                    <a href="{% url 'empresas:empresa_create' %}" class="submenu-link">
                        <span class="submenu-icon">➕</span>
                        Nueva Empresa
                    </a>
                </li>
            </ul>
        </li>
            
        <!-- Gestión de Usuarios - Desplegable -->
        <li class="nav-item has-submenu">
            <a href="#" class="nav-link" onclick="toggleSubmenu(this)" data-tooltip="Usuarios">
                <span class="nav-icon">👥</span>
                <span class="nav-text">Usuarios</span>
            </a>
            <ul class="submenu">
                <li>
                    <a href="/admin/auth/user/" class="submenu-link">
                        <span class="submenu-icon">👤</span>
                        Lista de Usuarios
                    </a>
                </li>
                <li>
                    <a href="/admin/auth/user/add/" class="submenu-link">
                        <span class="submenu-icon">➕</span>
                        Nuevo Usuario
                    </a>
                </li>
                <li>
                    <a href="/admin/auth/group/" class="submenu-link">
                        <span class="submenu-icon">👥</span>
                        Grupos
                    </a>
                </li>
                <li>
                    <a href="/admin/auth/permission/" class="submenu-link">
                        <span class="submenu-icon">🔐</span>
                        Permisos
                    </a>
                </li>
            </ul>
        </li>
        
        <!-- Gestión de Turnos - Desplegable -->
        <li class="nav-item has-submenu">
            <a href="#" class="nav-link" onclick="toggleSubmenu(this)" data-tooltip="Turnos">
                <span class="nav-icon">⏰</span>
                <span class="nav-text">Turnos</span>
            </a>
            <ul class="submenu">
                <li>
                    <a href="/admin/turnos/modeloturno/" class="submenu-link">
                        <span class="submenu-icon">📋</span>
                        Modelos de Turno
                    </a>
                </li>
                <li>
                    <a href="{% url 'programacion_dashboard' %}" class="submenu-link">
                        <span class="submenu-icon">📅</span>
                        Programaciones
                    </a>
                </li>
                <li>
                    <a href="/admin/turnos/asignacion/" class="submenu-link">
                        <span class="submenu-icon">📌</span>
                        Asignaciones
                    </a>
                </li>
            </ul>
        </li>
        
        <li class="nav-item">
            <a href="/admin/" class="nav-link" data-tooltip="Panel Admin">
                <span class="nav-icon">⚙️</span>
                <span class="nav-text">Panel Admin</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a href="#" class="nav-link" data-tooltip="Reportes">
                <span class="nav-icon">📊</span>
                <span class="nav-text">Reportes</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a href="#" class="nav-link" data-tooltip="Configuración">
                <span class="nav-icon">⚙️</span>
                <span class="nav-text">Configuración</span>
            </a>
        </li>
    </ul>
</nav>

<script>
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('collapsed');
    
    // Cerrar todos los submenús al colapsar
    if (sidebar.classList.contains('collapsed')) {
        document.querySelectorAll('.submenu').forEach(sm => {
            sm.style.display = 'none';
        });
    }
    
    // Guardar estado en localStorage
    const isCollapsed = sidebar.classList.contains('collapsed');
    localStorage.setItem('sidebarCollapsed', isCollapsed);
}

function toggleSubmenu(element) {
    // Si está colapsado, no hacer nada
    const sidebar = document.getElementById('sidebar');
    if (sidebar.classList.contains('collapsed')) {
        return;
    }
    
    const submenu = element.nextElementSibling;
    const isOpen = submenu.style.display === 'block';
    
    // Cerrar todos los otros submenús
    document.querySelectorAll('.submenu').forEach(sm => {
        if (sm !== submenu) {
            sm.style.display = 'none';
        }
    });
    
    // Toggle actual submenu
    if (isOpen) {
        submenu.style.display = 'none';
    } else {
        submenu.style.display = 'block';
    }
}

// Restaurar estado del sidebar al cargar
document.addEventListener('DOMContentLoaded', function() {
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isCollapsed) {
        document.getElementById('sidebar').classList.add('collapsed');
    }
});
</script>

<!-- Incluir CSS -->
<link rel="stylesheet" href="{% static 'css/sidebar.css' %}">